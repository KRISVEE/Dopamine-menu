<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dopamine Menu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin-custom { animation: spin 1s linear infinite; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        // --- 1. CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyC7Ct5hYhSVRHc3-o3RBbaWxHu4xByfHe0",
            authDomain: "dopamine-menu-c0340.firebaseapp.com",
            projectId: "dopamine-menu-c0340",
            storageBucket: "dopamine-menu-c0340.firebasestorage.app",
            messagingSenderId: "184986050340",
            appId: "1:184986050340:web:d3a9c4e187dd87c5a41db1",
            measurementId: "G-M6Y6EY56CM"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Enable offline persistence
        try {
            db.enablePersistence().catch(err => {
                console.log("Persistence suppressed (likely multiple tabs open)");
            });
        } catch(e) { console.log("Persistence init skipped"); }

        const appId = "dopamine-menu-google-v1";

        const { useState, useEffect } = React;

        // --- LOGIN SCREEN COMPONENT ---
        const LoginScreen = ({ onLogin }) => (
            <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-slate-50">
                <div className="bg-white p-8 rounded-3xl shadow-xl max-w-md w-full text-center border border-slate-100">
                    <div className="text-5xl mb-4">üß†</div>
                    <h1 className="text-3xl font-extrabold text-slate-900 mb-2">Dopamine Menu</h1>
                    <p className="text-slate-500 mb-8">Stop doomscrolling. Start doing.<br/>Sync across all your devices.</p>
                    
                    <button 
                        onClick={onLogin}
                        className="w-full py-4 px-6 bg-white border-2 border-slate-200 hover:bg-slate-50 text-slate-700 font-bold rounded-xl flex items-center justify-center gap-3 transition-all active:scale-95 shadow-sm"
                    >
                        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" className="w-6 h-6" />
                        Continue with Google
                    </button>
                    <p className="mt-6 text-xs text-slate-400">Secure login powered by Google</p>
                </div>
            </div>
        );

        const DopamineMenu = () => {
            const defaultMenu = {
                appetizers: [
                    { id: 1, text: 'Drink a glass of water', icon: 'üíß' },
                    { id: 2, text: 'Do 10 jumping jacks', icon: 'üèÉ' },
                    { id: 3, text: 'Pet the dog/cat', icon: 'üêï' },
                    { id: 4, text: 'Put on "Hype" playlist', icon: 'üéµ' },
                ],
                entrees: [
                    { id: 6, text: 'Work on coding project', icon: 'üíª' },
                    { id: 7, text: 'Go for a run/gym', icon: 'üí™' },
                ],
                sides: [
                    { id: 10, text: 'Fold laundry (w/ Podcast)', icon: 'üëï' },
                    { id: 11, text: 'Clear email inbox', icon: 'üìß' },
                ],
                desserts: [
                    { id: 14, text: 'Scroll TikTok (15 min timer)', icon: 'üì±' },
                    { id: 15, text: 'Watch one episode', icon: 'üì∫' },
                ],
            };

            const [user, setUser] = useState(null);
            const [menu, setMenu] = useState(defaultMenu);
            const [activeCategory, setActiveCategory] = useState('appetizers');
            const [randomPick, setRandomPick] = useState(null);
            const [isSpinning, setIsSpinning] = useState(false);
            const [newItem, setNewItem] = useState('');
            const [status, setStatus] = useState('loading');

            // 1. Auth Listener
            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((currentUser) => {
                    setUser(currentUser);
                    if (!currentUser) setStatus('login_needed');
                });
                return () => unsubscribe();
            }, []);

            // 2. Data Sync
            useEffect(() => {
                if (!user) return;

                const docRef = db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('data').doc('menu');
                
                setStatus('syncing');
                const unsubscribe = docRef.onSnapshot((docSnap) => {
                    if (docSnap.exists) {
                        setMenu(docSnap.data().items);
                        setStatus('saved');
                    } else {
                        docRef.set({ items: defaultMenu, createdAt: new Date() });
                        setStatus('saved');
                    }
                }, (error) => {
                    console.error("Sync Error", error);
                    setStatus('error');
                });
                return () => unsubscribe();
            }, [user?.uid]); 

            // 3. Save Function
            const saveMenu = async (newMenu) => {
                if (!user) return;
                
                setStatus('syncing');
                try {
                    const docRef = db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('data').doc('menu');
                    await docRef.set({ items: newMenu, updatedAt: new Date() }, { merge: true });
                } catch (e) {
                    setStatus('error');
                    alert("Could not save: " + e.message);
                }
            };

            const login = async () => {
                const provider = new firebase.auth.GoogleAuthProvider();
                try {
                    await auth.signInWithPopup(provider);
                } catch (error) {
                    alert("Login failed: " + error.message);
                }
            };

            const logout = () => auth.signOut();

            // Actions
            const handleAddItem = (e) => {
                e.preventDefault();
                if (!newItem.trim()) return;
                const item = { id: Date.now(), text: newItem, icon: '‚ú®' };
                saveMenu({ ...menu, [activeCategory]: [...menu[activeCategory], item] });
                setNewItem('');
            };

            const handleDelete = (id) => {
                saveMenu({ ...menu, [activeCategory]: menu[activeCategory].filter(i => i.id !== id) });
            };

            const pickRandom = () => {
                setIsSpinning(true);
                setRandomPick(null);
                let count = 0;
                const items = menu[activeCategory];
                if (items.length === 0) { setIsSpinning(false); return; }
                const interval = setInterval(() => {
                    setRandomPick(items[Math.floor(Math.random() * items.length)]);
                    count++;
                    if (count > 10) { clearInterval(interval); setIsSpinning(false); }
                }, 100);
            };

            const categories = {
                appetizers: { title: 'Appetizers', color: 'bg-amber-100 text-amber-800 border-amber-300', icon: '‚ö°' },
                entrees: { title: 'Entr√©es', color: 'bg-emerald-100 text-emerald-800 border-emerald-300', icon: 'üçΩÔ∏è' },
                sides: { title: 'Sides', color: 'bg-sky-100 text-sky-800 border-sky-300', icon: 'ü•ó' },
                desserts: { title: 'Desserts', color: 'bg-rose-100 text-rose-800 border-rose-300', icon: 'üç∞' },
            };

            if (!user) return <LoginScreen onLogin={login} />;

            return (
                <div className="min-h-screen pb-20">
                    {/* Header */}
                    <div className="bg-white border-b px-4 py-3 sticky top-0 z-20 flex justify-between items-center shadow-sm">
                        <h1 className="font-bold text-lg flex items-center gap-2">üß† Dopamine Menu</h1>
                        <div className="flex items-center gap-3">
                            <span className={`text-[10px] uppercase font-bold tracking-wider px-2 py-1 rounded-full ${status === 'saved' ? 'bg-green-100 text-green-600' : status === 'error' ? 'bg-red-100 text-red-600' : 'bg-yellow-100 text-yellow-600'}`}>
                                {status === 'saved' ? 'SYNCED' : status}
                            </span>
                            <img src={user.photoURL} className="w-8 h-8 rounded-full border border-gray-200 cursor-pointer" onClick={logout} title="Click to logout" />
                        </div>
                    </div>

                    <div className="max-w-2xl mx-auto p-4">
                        {/* Welcome Message */}
                        <div className="mb-6">
                            <h2 className="text-2xl font-bold text-slate-800">Hi, {user.displayName ? user.displayName.split(' ')[0] : 'Brain'}! üëã</h2>
                            <p className="text-slate-500">What does your brain need right now?</p>
                        </div>

                        {/* Tabs */}
                        <div className="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6">
                            {Object.entries(categories).map(([key, info]) => (
                                <button key={key} onClick={() => { setActiveCategory(key); setRandomPick(null); }}
                                    className={`p-3 rounded-2xl border-2 flex flex-col items-center justify-center transition-all duration-200
                                    ${activeCategory === key ? info.color + ' shadow-md scale-105' : 'bg-white border-slate-100 text-slate-400 hover:bg-slate-50'}`}>
                                    <span className="text-xl mb-1">{info.icon}</span>
                                    <span className="text-xs font-bold uppercase tracking-wide">{info.title}</span>
                                </button>
                            ))}
                        </div>

                        {/* Main Card */}
                        <div className="bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden">
                            <div className={`px-6 py-4 border-b border-slate-50 flex justify-between items-center bg-opacity-30 ${categories[activeCategory].color.split(' ')[0]}`}>
                                <h2 className="text-lg font-bold flex items-center gap-2">
                                    {categories[activeCategory].icon} {categories[activeCategory].title}
                                </h2>
                                <button onClick={pickRandom} disabled={isSpinning} className="px-5 py-2 bg-slate-900 text-white rounded-xl font-bold shadow-lg active:scale-95 transition-all text-sm flex items-center gap-2">
                                    {isSpinning ? <div className="animate-spin-custom">üé≤</div> : 'üé≤ Pick One'}
                                </button>
                            </div>

                            {/* Result Area */}
                            {randomPick && (
                                <div className="bg-indigo-600 text-white p-8 text-center animate-in fade-in zoom-in duration-300">
                                    <div className="text-5xl mb-3">{randomPick.icon}</div>
                                    <div className="text-2xl font-bold leading-tight">{randomPick.text}</div>
                                </div>
                            )}

                            {/* List */}
                            <div className="divide-y divide-slate-50 max-h-[50vh] overflow-y-auto">
                                {menu[activeCategory].length === 0 ? (
                                    <div className="p-8 text-center text-slate-400 text-sm">Nothing here yet. Add something!</div>
                                ) : (
                                    menu[activeCategory].map((item) => (
                                        <div key={item.id} className="flex justify-between items-center p-4 hover:bg-slate-50 transition-colors group">
                                            <div className="flex gap-4 items-center">
                                                <span className="text-xl bg-white p-2 rounded-lg shadow-sm border border-slate-100">{item.icon}</span>
                                                <span className="font-medium text-slate-700">{item.text}</span>
                                            </div>
                                            
                                            {/* UPDATED DELETE BUTTON: Always visible on mobile, Hover only on Desktop */}
                                            <button 
                                                onClick={() => handleDelete(item.id)} 
                                                className="opacity-100 md:opacity-0 md:group-hover:opacity-100 p-3 text-slate-300 hover:text-red-500 active:text-red-600 transition-all"
                                                title="Delete Item"
                                            >
                                                üóëÔ∏è
                                            </button>
                                        </div>
                                    ))
                                )}
                            </div>

                            {/* Add Item */}
                            <form onSubmit={handleAddItem} className="p-4 bg-slate-50 border-t border-slate-100 flex gap-2">
                                <input 
                                    value={newItem} 
                                    onChange={e => setNewItem(e.target.value)} 
                                    placeholder={`Add to ${categories[activeCategory].title}...`} 
                                    className="flex-1 px-4 py-3 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 shadow-sm" 
                                />
                                <button type="submit" className="w-12 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition-colors shadow-md flex items-center justify-center text-xl">+</button>
                            </form>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DopamineMenu />);
    </script>
</body>
</html>
